# TAITS_最新總架構__251217.md

> doc_key：MASTER_ARCH_CANON  
> 架構等級：A（系統骨架｜不可推翻）  
> 適用範圍：TAITS 全系統  
> 狀態：ACTIVE（Canonical Architecture｜Only-Add）

---

## 0. 文件定位（Architecture Canon）

本文件定義 **TAITS（Taiwan Alpha Intelligence Trading System）的整體系統架構**，  
回答的不是「怎麼做」，而是：

- TAITS 由哪些模組組成
- 各模組的責任邊界是什麼
- 哪些事情「一定不能混在一起」

📌 本文件為 **所有流程、策略、實作的結構上限**，  
任何設計 **不得違反本架構所定義的邊界與層級關係**。

---

## 1. 架構設計總原則（不可違反）

### 1.1 Canon-first 原則
- 架構先行，實作其後
- 任何實作不得反推修改架構

### 1.2 三權分立（最高結構原則）
- Strategy（策略）≠ Execution（執行）≠ Risk / Compliance（風控合規）
- 任一層不得越權侵入另一層

### 1.3 Governance Over Signals
- 治理與風控高於任何單一訊號或策略結果

### 1.4 Only-Add
- 架構只允許擴充，不允許縮水或合併責任

---

## 2. TAITS 系統總覽（Top-Level View）

TAITS 在邏輯上由以下 **八大核心層級** 組成：

1. Data Layer（資料層）
2. Feature Layer（特徵層）
3. Strategy Layer（策略層）
4. Regime Layer（市場狀態層）
5. Risk / Compliance Layer（風控合規層）
6. Execution Layer（執行層）
7. Portfolio / Capital Layer（資金與組合層）
8. Audit / Governance Layer（審計與治理層）

📌 各層之間 **單向依賴、禁止環狀耦合**。

---

## 3. 各層級責任定義（Boundary Definition）

---

### 3.1 Data Layer（資料層）

**責任**
- 蒐集、接收、儲存原始資料
- 確保資料可回放、可追溯

**包含**
- 官方資料來源（TWSE / TPEX / 券商）
- 價量、基本面、事件、制度資料

**禁止**
- 不做任何交易判斷
- 不產生訊號

---

### 3.2 Feature Layer（特徵層）

**責任**
- 將原始資料轉換為可用特徵
- 標準化、正規化、版本化

**禁止**
- 不包含策略邏輯
- 不直接影響交易決策

---

### 3.3 Strategy Layer（策略層）

**責任**
- 基於 Feature 產生「交易意圖（Intent）」
- 提供理由與適用範圍（Meta）

**輸出**
- StrategyIntent（方向、信心、理由）

**禁止**
- 不得包含否決（Veto）
- 不得指定下單方式、價格、券商

---

### 3.4 Regime Layer（市場狀態層）

**責任**
- 判斷市場所處狀態（趨勢 / 震盪 / 風險）
- 為 Strategy 與 Risk 提供環境上下文

**特性**
- 不直接下單
- 可被 Risk 使用

---

### 3.5 Risk / Compliance Layer（風控合規層）

**責任**
- 最終允許 / 否決 / 降級交易行為
- 風險暴露控制
- 合規與制度限制

**權限**
- Runtime 否決權（最高）

**禁止**
- 不生成交易方向
- 不修改策略邏輯

---

### 3.6 Execution Layer（執行層）

**責任**
- 承接已被允許的 StrategyIntent
- 交易單位路由（零股 / 整股 / 混合）
- 券商 API 適配
- 失敗處理與重試策略（非實盤自動）

**禁止**
- 不得繞過 Risk
- 不得假設一定成交

---

### 3.7 Portfolio / Capital Layer（資金與組合層）

**責任**
- 管理資金配置
- 倉位、曝險、相關性控制

**特性**
- 與 Strategy 解耦
- 受 Risk 約束

---

### 3.8 Audit / Governance Layer（審計與治理層）

**責任**
- Log、Replay、Explainability
- 治理規則執行
- AI 行為約束

**地位**
- 橫跨全系統
- 高於其他層級

---

## 4. 系統依賴方向（Dependency Rules）

合法依賴方向（由上而下）：

Data
→ Feature
→ Strategy
→ Regime
→ Risk
→ Execution
→ Portfolio
→ Audit (橫向)

yaml
複製程式碼

📌 **不允許反向依賴或跳層呼叫**。

---

## 5. 交易產品與單位在架構中的位置

- 交易產品（如 STOCK）屬於 **Execution 與 Risk 的共同約束**
- 交易單位（odd_lot / full_lot / hybrid）屬於 **Execution 編排**
- Strategy 只能「宣告支援」，不得控制

---

## 6. 人類與 AI 在架構中的位置

### 人類（Human Operator）
- 位於 Governance 層之上
- 擁有最終裁決權

### AI
- 分布於 Data / Feature / Strategy / Governance 輔助
- **不擁有最終決策權**

---

## 7. 架構演進原則

- 可新增新層（如 Macro Layer）
- 可細分子模組
- **不可合併或刪除既有層級**
- 重大變更需新增新版本文件

---

## 8. 架構最終宣告

> **TAITS 的架構不是為了「現在能不能跑」，  
而是為了「十年後還能不能看懂」。**

---

（End of MASTER_ARCH_CANON）
