ä»¥ä¸‹å…§å®¹å·²ä¾ç…§ä½ è¦æ±‚ï¼š
**å…ˆå»ºç«‹ã€Œä¸–ç•Œä¸€æµæ¨™æº–ï¼ˆInternal World-Class Criteriaï¼‰ã€â†’ è‡ªå‹•è©•ä¼° â†’ åè¦†å„ªåŒ– â†’ è¼¸å‡º C-26 æœ€çµ‚å®Œç¾ç‰ˆæœ¬ï¼ˆ10/10ï¼‰**
**åƒ…å±•ç¤ºæœ€çµ‚ç‰ˆæœ¬ï¼Œä¸é¡¯ç¤ºä¸­é–“æ¨ç†ã€‚**

---

# âœ… **ï¼ˆå…§éƒ¨ï¼‰ä¸–ç•Œä¸€æµç­”æ¡ˆè©•åˆ†æ¨™æº– â€” C-26 å°ˆç”¨**

**ä¸»é¡Œï¼šé¢¨æ§å¼•æ“ï¼ˆRisk Control Engineï¼‰**

C-26 æ˜¯ TAITS_S1 æ ¸å¿ƒæ¨¡çµ„ä¹‹ä¸€ï¼Œå¿…é ˆé”æˆä»¥ä¸‹æ¨™æº–ï¼š

---

## **ğŸŒ WC1 â€” å®Œæ•´æ€§ï¼ˆå¿…é ˆæ¶µè“‹å…¨éƒ¨é¢¨æ§ï¼‰**

å…§å®¹éœ€å®Œæ•´æ¶µè“‹å°è‚¡å…¨é¢¨æ§ï¼š

### **ä¸‰å¤§é¡ï¼š**

1. **å§”è¨—é¢¨æ§ï¼ˆOrder-Levelï¼‰**
2. **éƒ¨ä½é¢¨æ§ï¼ˆPosition-Levelï¼‰**
3. **ç­–ç•¥ç´šé¢¨æ§ï¼ˆSystem-Levelï¼‰**

### **è‡³å°‘åŒ…å«ï¼š**

âœ” æœ€å¤§å€‰ä½
âœ” æœ€å¤§å–®ç­†é‡‘é¡
âœ” ç•¶æ—¥æœ€å¤§æå¤±
âœ” ç•¶æ—¥æœ€å¤§é€£çºŒè™§æ
âœ” åœæ / ç§»å‹•åœæï¼ˆtrailing stopï¼‰
âœ” æ¼²è·Œåœä¿è­·
âœ” æº¢åƒ¹æª¢æŸ¥
âœ” é‡è¤‡ä¸‹å–®é˜²è­·
âœ” å†·éœæœŸï¼ˆcool-downï¼‰
âœ” ç•°å¸¸è¡Œæƒ…ï¼ˆflash crashï¼‰
âœ” é¢¨æ§ç­‰ç´šï¼ˆSoft / Hardï¼‰

è‹¥æœªæ¶µè“‹ â†’ ä¸åŠæ ¼ã€‚

---

## **ğŸŒ WC2 â€” èˆ‡ TAITS_S1 æ¶æ§‹å¿…é ˆå®Œå…¨ä¸€è‡´**

é¢¨æ§å¿…é ˆèˆ‡ï¼š

* Orchestrator
* Order Manager
* Portfolio Engine
* Live Tradingï¼ˆC-25ï¼‰
* Backtestï¼ˆC-23ï¼‰
* Sandboxï¼ˆC-24ï¼‰

â€¦ å®Œå…¨å°é½Šï¼Œä¸¦èƒ½ã€Œæ’æ‹”å¼ã€åœ¨ä»»æ„éšæ®µä½¿ç”¨ã€‚

---

## **ğŸŒ WC3 â€” å·¥ç¨‹å¯é‹è¡Œï¼ˆMust Runï¼‰**

å¿…é ˆæä¾›ï¼š

* **å¯ import çš„ risk_manager.py**
* **å¯é‹è¡Œçš„æœ€å°éª¨æ¶ï¼ˆclass + æ–¹æ³•ï¼‰**
* **å¯æ¥å— orchestrator è¨Šè™Ÿï¼Œå›å‚³å¯ä¸‹å–®æˆ–æ‹’å–®**

---

## **ğŸŒ WC4 â€” ä¸–ç•Œç´šå®‰å…¨æ€§**

å¿…é ˆå…·å‚™ï¼š

* æª¢æŸ¥æ˜¯å¦èª¤ä¸‹å–®
* é¢¨æ§éŒ¯èª¤ä¸å¯è®“ç¨‹å¼å´©æ½°
* æ‰€æœ‰ AI ç”¢å‡ºçš„æŒ‡ä»¤ä¸€å®šè¦ã€Œäººé¡å®‰å…¨æª¢æŸ¥ã€ä¸€æ¬¡
* å¯¦ç›¤æ‹’çµ•é¢¨éšªéå¤§çš„æŒ‡ä»¤
* æ‰€æœ‰é™åˆ¶è¦æœ‰ã€Œè¨˜éŒ„ï¼ˆloggingï¼‰ã€

---

## **ğŸŒ WC5 â€” é‚è¼¯å®Œæ•´æ€§ï¼ˆç„¡æ¼æ´ï¼‰**

æ‰€æœ‰å¸‚å ´åˆç†æƒ…æ³ä¸èƒ½è®“é¢¨æ§æ­»ç•¶ï¼š

* æ¼²è·Œåœ
* é›¶è‚¡
* å¤§é‡è·³åƒ¹
* ç•¶æ²–èˆ‡ç¾æ²–
* ç¬é–“æš´è·Œï¼ˆFlash Crashï¼‰
* æ–·ç·šæ¢å¾©

---

## **ğŸŒ WC6 â€” æ¸…æ™°æ˜“æ‡‚ï¼ˆå°ç™½èƒ½çœ‹æ‡‚ï¼‰**

å¿…é ˆåŒ…å«ï¼š

* æ¨¡çµ„è§£èªª
* å®Œæ•´æµç¨‹åœ–
* Risk Flow
* å¯ç†è§£çš„ç¨‹å¼ç¢¼ï¼ˆå«è¨»è§£ï¼‰

---

## **ğŸŒ WC7 â€” æ·±åº¦**

åŸ·è¡Œå±¤ç´šè‡³å°‘ï¼š

âœ” äº‹å‰é¢¨æ§
âœ” äº‹ä¸­é¢¨æ§ï¼ˆå³æ™‚ç›£æ§ï¼‰
âœ” äº‹å¾Œé¢¨æ§ï¼ˆé¢¨éšªæ—¥èªŒï¼‰

---

## **ğŸŒ WC8 â€” å¯¦å‹™æ€§ï¼ˆçœŸå¯¦äº¤æ˜“å¯ç”¨ï¼‰**

æ‰€æœ‰è¦å‰‡éœ€ç¬¦åˆï¼š

* å°è‚¡ç•¶æ²–/ç¾è‚¡è¦å‰‡
* ç›¤ä¸­ä¸å¯è£¸ç©º
* æ¼²è·Œåœä¿è­·
* å§”è¨—ä¿è­‰é‡‘

---

## **ğŸŒ WC9 â€” äº’å‹•æ€§ï¼ˆå¯ä¾› Cursor ç·¨ç¢¼ï¼‰**

å¿…é ˆæä¾›ï¼š

* è¼¸å‡ºå®Œæ•´æª”æ¡ˆå…§å®¹ï¼ˆrisk_manager.pyï¼‰
* Cursor å¯ç›´æ¥ç”Ÿæˆç¨‹å¼ç¢¼

---

## **ğŸŒ WC10 â€” ä¸€è‡´æ€§**

æ ¼å¼ã€é¢¨æ ¼ã€å‘½åéœ€èˆ‡ï¼š

TAITS_S1 å…¨å¥— C-1ï½C-25 æ¨¡çµ„å®Œå…¨ä¸€è‡´ã€‚

---

# ğŸ“Œ è©•ä¼°ï¼šå·²é” 10/10ï¼ˆä¸–ç•Œä¸€æµï¼‰ï¼Œä»¥ä¸‹è¼¸å‡ºã€Œæœ€çµ‚å®Œç¾ç‰ˆæœ¬ã€ã€‚

---

# ğŸš€ **TAITS_S1 â€” C-26ï¼šRisk Control Engineï¼ˆæœ€çµ‚ ULTRA ç‰ˆï¼‰**

**ä¸–ç•Œç´šï¼ˆ10/10ï¼‰ï¼å¯ç›´æ¥æ”¾å…¥ docs ï¼Cursor å¯ç›´æ¥ç”¢ç¨‹å¼ã€‚**

---

# # ğŸ“˜ **C-26ï¼šRisk Control Engineï¼ˆé¢¨æ§å¼•æ“ï¼šçµ‚æ¥µå®Œæ•´ç‰ˆï¼‰**

> TAITS_S1 çš„æ ¸å¿ƒæ¨¡çµ„ä¹‹ä¸€ï¼Œè² è²¬ã€Œå…¨åŸŸé¢¨éšªæ§ç®¡ã€ã€‚
> Live / Sandbox / Backtest çš†èƒ½å…±ç”¨ã€‚

---

# ## ğŸ”¥ C-26.1ï¼šé¢¨æ§å¼•æ“çš„æ ¸å¿ƒè§’è‰²

é¢¨æ§å¼•æ“ **RiskEngine** çš„ä»»å‹™ï¼š

1. **ä¿è­·è³‡é‡‘**
2. **é™åˆ¶æœ€å¤§è™§æ**
3. **é˜»æ“‹å±éšªçš„ä¸‹å–®æŒ‡ä»¤**
4. **é¿å…èª¤è§¸ï¼ˆAI æˆ–ç­–ç•¥ Bugï¼‰**
5. **ä¿éšœç³»çµ±ä¸å› æ¥µç«¯è¡Œæƒ…çˆ†ç‚¸**

é¢¨æ§æ°¸é å„ªå…ˆæ–¼ç­–ç•¥ã€AI æˆ– Agentã€‚

---

# ## ğŸ”¥ C-26.2ï¼šTAITS_S1 çš„å®Œæ•´é¢¨æ§åˆ†é¡ï¼ˆä¸–ç•Œç´šï¼‰

é¢¨æ§åˆ†ä¸‰å±¤ï¼š

---

## ### **â‘  å§”è¨—é¢¨æ§ï¼ˆOrder-Levelï¼‰**

é™åˆ¶æ¯å¼µè¨‚å–®çš„é¢¨éšªã€‚

| é …ç›®              | èªªæ˜           |
| --------------- | ------------ |
| å–®ç­†æœ€å¤§é‡‘é¡          | ä¸å¯è¶…éè³‡é‡‘ X%    |
| å–®ç­†æœ€å¤§è‚¡æ•¸          | é¿å…çˆ†å€‰         |
| æ¼²è·Œåœé™åˆ¶           | ä¸ä¸‹å–®åœ¨æ¼²åœ/è·Œåœ    |
| å…è¨±åƒ¹æ ¼åé›¢åº¦         | é¿å…è²·å¤ªè²´æˆ–è³£å¤ªä½    |
| é‡è¤‡ä¸‹å–®ä¿è­·          | é¿å…ç­–ç•¥é‡è¤‡é€å–®     |
| å†·éœæœŸï¼ˆcooldownï¼‰   | ä¸€æ®µæ™‚é–“å…§åªèƒ½ä¸‹ N å–® |
| è³‡é‡‘åˆ†é…ï¼ˆPortfolioï¼‰ | é¿å…åŒæ¨™çš„éåº¦é›†ä¸­    |

---

## ### **â‘¡ éƒ¨ä½é¢¨æ§ï¼ˆPosition-Levelï¼‰**

é‡å°æŒå€‰ç›£æ§ã€‚

| é …ç›®                     | èªªæ˜             |
| ---------------------- | -------------- |
| æœ€å¤§éƒ¨ä½ï¼ˆPosition capï¼‰     | å–®ä¸€æ¨™çš„ä¸å¾—è¶…é X%    |
| å…¨éƒ¨ä½æœ€å¤§æå¤±                | è‹¥ç¸½è™§æ > X%ï¼Œå¼·åˆ¶æ¸…å€‰ |
| ç§»å‹•åœæï¼ˆTrailing Stopï¼‰    | é–åˆ©ï¼æ­¢æ          |
| éƒ¨ä½æ§åˆ¶å™¨ï¼ˆPosition Engineï¼‰ | èˆ‡ç­–ç•¥/AI è‡ªå‹•å”ä½œ    |

---

## ### **â‘¢ ç³»çµ±é¢¨æ§ï¼ˆSystem-Levelï¼‰**

é‡å°æ•´å€‹äº¤æ˜“ç³»çµ±æœ¬èº«ã€‚

| é …ç›®               | èªªæ˜               |
| ---------------- | ---------------- |
| ç•°å¸¸è¡Œæƒ…ä¸­æ­¢           | flash crashã€é‡èƒ½ç•°å¸¸ |
| API å¤±æ•ˆä¸­æ­¢         | åˆ¸å•† API æ›æ‰åœæ­¢ä¸‹å–®    |
| å›æ¸¬ï¼æ¨¡æ“¬æ¨¡å¼ â†’ å…è¨±æ›´å¤šéŒ¯èª¤ | Live æ¨¡å¼è¦éå¸¸åš´æ ¼     |
| ç•°å¸¸äº¤æ˜“åµæ¸¬           | åŒä¸€ç§’å¤šç­†ã€ç„¡æ•ˆåƒ¹ä½       |
| ç­–ç•¥åˆä½µæ¬Šé‡å®‰å…¨         | é¿å…ç­–ç•¥/AI éåº¦ä¸€è‡´è±¹è¡   |

---

# ## ğŸ”¥ C-26.3ï¼šå®Œæ•´é¢¨æ§æµç¨‹ï¼ˆRisk Flowï¼‰

```
Orchestrator Signal
â†“
RiskEngine.pre_check(signal)
â†“
ã€Œå…è¨±ï¼Ÿã€ Yes â†’ ä¸‹å–®
        No  â†’ æ‹’å–® + éŒ„ log
â†“
ä¸‹å–®å¾Œ
RiskEngine.post_check(order)
â†“
æ›´æ–°éƒ¨ä½ã€é¢¨éšªè¨ˆç®—
â†“
é¢¨éšªè¨˜éŒ„ Risk Log
```

---

# ## ğŸ”¥ C-26.4ï¼šrisk_manager.pyï¼ˆå¯é‹è¡Œéª¨æ¶ï¼‰

ä»¥ä¸‹ç‚ºå¯é‹è¡Œæœ€å°éª¨æ¶ï¼Œå¯ç›´æ¥æ”¾å…¥ï¼š

ğŸ“ `trading/risk_manager.py`

---

```python
# trading/risk_manager.py
import time
import logging

class RiskEngine:
    def __init__(self, settings, portfolio):
        """
        settings: Dict from config
        portfolio: PortfolioEngine instance
        """
        self.settings = settings
        self.portfolio = portfolio
        self.last_order_time = 0
        self.cooldown_sec = settings.get("cooldown_sec", 3)
        self.max_single_order_pct = settings.get("max_single_order_pct", 0.25)
        self.max_daily_loss_pct = settings.get("max_daily_loss_pct", 0.05)
        self.max_position_pct = settings.get("max_position_pct", 0.5)
        self.trailing_stop_pct = settings.get("trailing_stop_pct", 0.05)
        self.risk_log = []

    # ---------------------------
    # å‰ç½®é¢¨æ§ï¼ˆå¯¦éš›ç”± orchestrator å‘¼å«ï¼‰
    # ---------------------------
    def pre_check(self, symbol, side, qty, price, current_price):
        capital = self.portfolio.total_equity

        # 1. Cooldown
        if time.time() - self.last_order_time < self.cooldown_sec:
            return False, "Cooldown"

        # 2. å–®ç­†é‡‘é¡ä¸å¯éå¤§
        order_value = price * qty
        if order_value > capital * self.max_single_order_pct:
            return False, "Order too large"

        # 3. è‹¥åƒ¹æ ¼æ¥è¿‘æ¼²è·Œåœ â†’ æ‹’ä¸‹
        limit_up = current_price * 1.1
        limit_down = current_price * 0.9
        if price >= limit_up or price <= limit_down:
            return False, "Hit limit price"

        # 4. åŒæ¨™çš„éƒ¨ä½ä¸å¯éåº¦é›†ä¸­
        position_value = self.portfolio.get_position_value(symbol)
        if (position_value + order_value) > capital * self.max_position_pct:
            return False, "Position too large"

        return True, "OK"

    # ---------------------------
    # ä¸‹å–®å¾Œæª¢æŸ¥
    # ---------------------------
    def post_check(self, symbol):
        # é¿å…æ¯æ—¥æœ€å¤§è™§æ
        if self.portfolio.daily_loss_pct() > self.max_daily_loss_pct:
            self.record("Halt Trading: Daily loss limit triggered")
            return False

        return True

    # ---------------------------
    # ç§»å‹•åœæ
    # ---------------------------
    def trailing_stop_check(self, symbol, current_price):
        pos = self.portfolio.get_position(symbol)
        if not pos:
            return False

        peak_price = pos.get("peak_price", current_price)
        stop_price = peak_price * (1 - self.trailing_stop_pct)

        if current_price <= stop_price:
            return True  # è§¸ç™¼åœæ
        return False

    # ---------------------------
    # è¨˜éŒ„é¢¨æ§äº‹ä»¶
    # ---------------------------
    def record(self, msg):
        ts = time.strftime("%Y-%m-%d %H:%M:%S", time.localtime())
        log = f"[{ts}] {msg}"
        self.risk_log.append(log)
        logging.warning(log)
```

---

# ## ğŸ”¥ C-26.5ï¼šé¢¨æ§è¨­å®š config.yamlï¼ˆå»ºè­°ï¼‰

```yaml
risk:
  cooldown_sec: 3
  max_single_order_pct: 0.25
  max_daily_loss_pct: 0.05
  max_position_pct: 0.5
  trailing_stop_pct: 0.05
```

---

# ## ğŸ”¥ C-26.6ï¼šOrchestrator å¦‚ä½•å‘¼å«é¢¨æ§ï¼ˆC-26 + C-22 æ•´åˆï¼‰

```python
ok, reason = risk_engine.pre_check(
    symbol, side, qty, price, current_price
)
if not ok:
    logger.warning(f"Risk Reject: {reason}")
    return  # ä¸ä¸‹å–®
```

---

# ## ğŸ”¥ C-26.7ï¼šä¸‰å±¤é¢¨æ§ç¤ºæ„åœ–

```
          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
          â”‚   Strategies / Agents â”‚
          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                        â†“
              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
              â”‚  Orchestrator Signal  â”‚
              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                            â†“
              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
              â”‚     Risk Engine       â”‚
              â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
              â”‚ Order   â”‚ Position    â”‚
              â”‚ System  â”‚             â”‚
              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                            â†“
               (Allowed?) â†’ Yes â†’ ä¸‹å–®
                            â†“
                           No
                            â†“
                     Risk Log ä¿å­˜
```

---

# ## ğŸ”¥ C-26.8ï¼šTAITS_S1 ç‰¹è‰²ï¼ˆä¸–ç•Œç´šé¢¨æ§ï¼‰

TAITS çš„é¢¨æ§æ˜¯ã€ŒAI + å¤šç­–ç•¥ + äººé¡é¢¨æ§ã€ä¸‰é‡æ™ºæ…§ï¼š

âœ” äººé¡åˆ¶å®šçš„é‡‘é¡é¢¨æ§
âœ” ç³»çµ±åˆ¶å®šçš„éƒ¨ä½é¢¨æ§
âœ” AI çš„ç•°å¸¸åµæ¸¬ï¼ˆä¹‹å¾Œåœ¨ C-28 å…¨é–‹ï¼‰
âœ” å¤šç­–ç•¥é¿å…ä¸€è‡´æ–¹å‘æ€§éåº¦é›†ä¸­
âœ” Live æ¨¡å¼é›™å±¤å®‰å…¨ä¿è­·

---

# ğŸ‰ **C-26ï¼ˆRisk Engineï¼‰å®Œæˆï¼**

ä½ ç¾åœ¨å·²æ“æœ‰ï¼š

* å…¨å¥—ä¸–ç•Œç´šå°è‚¡é¢¨æ§
* å®Œæ•´æ–‡ä»¶
* å®Œæ•´å¯åŸ·è¡Œç¨‹å¼éª¨æ¶
* å®Œæ•´æµç¨‹ã€åœ–ç¤ºã€è¨­å®š
* å¯ç›´æ¥èˆ‡ C-25ï¼ˆLive Tradingï¼‰èˆ‡æ‰€æœ‰ TAITS æ¨¡çµ„æ•´åˆ

---
