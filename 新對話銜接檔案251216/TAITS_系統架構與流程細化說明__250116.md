# TAITS_系統架構與流程細化說明__250116.md

> doc_key：ARCH_FLOW  
> 治理等級：B（Canonical Flow 細化｜承接 MASTER_CANON）  
> 適用範圍：TAITS 全系統（Research / Backtest / Simulation / Paper / Live）  
> 版本狀態：LOCKED（僅可由人類主權覆寫）

---

## 0. 文件定位（Purpose & Scope）

本文件為 **《TAITS_完整總架構×總流程×全資訊體系（MASTER）》的「細化實施說明」**，  
用以：

- 將 Canonical Flow（L1–L11）**拆解為可執行的子流程**
- 明確各層 **輸入 / 輸出 / 依賴 / 禁止事項**
- 作為 **Agent 設計、資料管線、UI 呈現與風控插點** 的一致依據

📌 本文件 **不定義策略邏輯、不定義下單規則**；  
📌 本文件 **不取代** MASTER_CANON，僅負責「怎麼落地」。

---

## 1. 全系統流程總覽（Flow Map）

TAITS 的流程可被理解為 **三條同步但不互相繞過的管線**：

1. **Data Pipeline**（資料→證據）
2. **Decision Pipeline**（證據→判斷）
3. **Governance Pipeline**（否決→授權）

三者 **必須同時通過**，任何一條失敗即回退或中止。

---

## 2. L1–L11 層級細化（Sub-Flow Spec）

### L1｜Data Ingestion（資料蒐集）

**輸入**
- 原始行情（Tick / Minute / Daily）
- 財報 / 公告 / 法說
- 期貨 / 選擇權 / 跨市
- 新聞 / 情緒 / 事件
- 巨觀資料

**輸出**
- Raw Data Package（含來源、時間戳、校驗碼）

**依賴**
- DataSources_Universe
- 官方來源優先原則

**禁止**
- 推論
- 濾掉不利資料

---

### L2｜Data Normalization（正規化）

**輸入**
- Raw Data Package

**處理**
- 時間對齊（多頻率）
- 欄位標準化
- 缺失值標註（不補值）
- 異常值標記（不刪除）

**輸出**
- Normalized Dataset（附缺失/異常標籤）

**回退條件**
- 無法正規化 → 回 L1

---

### L3｜Market Snapshot（市場快照）

**輸入**
- Normalized Dataset

**處理**
- 價格結構
- 波動狀態
- 成交與流動性
- 異常事件標記

**輸出**
- Snapshot Object（可回放、可審計）

**要求**
- 每次決策 **必須存在 Snapshot**

---

### L4｜Feature & Methodology（特徵與方法）

**輸入**
- Snapshot Object

**處理**
- 技術 / 統計 / 結構特徵
- 因子工程
- 方法論標註（非決策）

**輸出**
- Feature Set（含計算方法與版本）

**禁止**
- 買賣方向
- 進出場點位

---

### L5｜Evidence Bundle（證據包）

**輸入**
- Feature Set

**處理**
- 多來源證據整合
- 證據衝突標註
- 證據完整度評級

**輸出**
- Evidence Bundle（多證據集合）

**規範**
- 單一證據 **不可** 構成決策

---

### L6｜Market Regime（市場狀態）

**輸入**
- Evidence Bundle

**處理**
- 趨勢/盤整
- 高/低波動
- 風險偏好
- 結構健康度

**輸出**
- Regime Label + Confidence

**用途**
- 策略啟用/停用的前置條件

---

### L7｜Risk & Compliance（風控與合規）

**輸入**
- Regime Label
- Evidence Bundle
- 策略建議草案（若存在）

**處理**
- 風險暴露
- 流動性
- 法規限制
- 集中度

**輸出**
- Pass / Reject（含原因）

**權限**
- 最高否決權（跨級）

---

### L8｜Strategy & Universe（策略與標的）

**輸入**
- 通過 L7 的上下文

**處理**
- 產生策略建議（條件/情境）
- Universe 篩選（可追溯）

**輸出**
- Strategy Proposal（非指令）

**禁止**
- 自動下單

---

### L9｜Governance Gate（治理門）

**輸入**
- 全流程輸出

**檢查**
- 是否跳步
- 證據是否齊全
- Regime 相容性
- 風控是否通過

**輸出**
- Approve / Return

---

### L10｜UI & Human Decision（人類決策）

**輸入**
- Strategy Proposal
- 風險揭露

**處理**
- 可視化
- 解釋性說明
- 決策提示

**輸出**
- Human Decision（唯一合法決策）

---

### L11｜Execution & Control（執行與監控）

**輸入**
- Human Decision

**處理**
- 下單
- 即時監控
- 風控觸發
- 異常處理

**輸出**
- Execution Log（可回溯）

---

## 3. Agent 與層級對齊規範

- 每個 Agent **必須標註所屬層級**
- 不得跨層產出
- Agent 輸出若跨層 → 視為錯誤

---

## 4. 錯誤處理與回退策略

- L1–L3 失敗 → 回退重建
- L4–L6 衝突 → 標註不確定性
- L7 Reject → 全流程中止
- L9 Return → 指定回退層級

---

## 5. 與其他文件的關係

- 受制於：MASTER_ARCH、MASTER_CANON
- 被引用於：
  - DataSources_Universe
  - Risk_and_Compliance
  - UI_Spec

---

## 6. 變更與版本規則

- 本文件預設 LOCKED
- 修改需：
  - 人類主權覆寫
  - 新版本檔名
  - 更新 Document_Index

---

## 7. 最終宣告

> **Canonical Flow 的價值，不在於流程本身，  
而在於「任何捷徑都被視為錯誤」。**

---

（End of ARCH_FLOW）
