# TAITS_最新總架構__251217.md

> doc_key：ARCH_LATEST  
> 治理等級：A（Architecture Canon）  
> 適用範圍：TAITS 全系統  
> 狀態：ACTIVE（Working Canon｜Only-Add）

---

## 0. 本文件定位

本文件描述 TAITS（Taiwan Alpha Intelligence Trading System，台灣阿爾法智能交易系統）目前「最新且有效」的總架構母體，用於：

- 統一所有新對話與新文件的理解基準
- 作為未來一次性總整理（Index/Repo 整併）的權威來源
- 確保架構可長期演進（可插拔、可治理、可審計）

---

## 1. 最高設計原則（不可違反）

### 1.1 三權分立（Separation of Concerns｜職責分離）
- Strategy（策略）≠ Execution（執行）≠ Risk/Compliance（風控/合規）
- Risk / Compliance 具最終否決權（Final Veto）

### 1.2 Regime 高於單一訊號
- Market Regime（市場狀態/市場體質）決定策略可否啟用、可否加碼、可否升級交易單位

### 1.3 AI ≠ 唯一真理
- AI 僅可作為輔助分析與摘要，不可繞過治理、不具最終裁決權

### 1.4 官方來源優先（Official Sources First）
- 市場制度、撮合規則、交易限制以 TWSE/TPEX/官方公告引用為準
- 系統不寫死易變動細節（避免規則更新造成返工）

### 1.5 Only-Add 進化
- 已確認的治理邊界不回退
- 新增內容必須可向前擴充，不可破壞審計與控管

---

## 2. 目前啟用範圍（Scope Freeze｜凍結範圍）

### 2.1 已啟用（現階段唯一有效）
- 市場：TWSE/TPEX（台股現貨）
- 產品（Product／交易品類）：STOCK（股票）
- 交易單位（Trade Unit／交易單位）：
  - odd_lot（零股）＝啟用
  - full_lot（整股）＝預留、未啟用
- 模式（Execution Mode／執行模式）：research / simulation / paper
- 券商 API：富邦 TradeAPI（Fubon TradeAPI）

### 2.2 預留但未啟用（只保留制度與介面）
- Hybrid（混合交易單位編排：零股↔整股）＝Execution 預留、未啟用
- 期貨/選擇權/權證/融資融券/美股＝制度保留、未啟用

---

## 3. TAITS 核心模組總覽（高層）

TAITS 以「產品模組化 + 三權分立」組成。

### 3.1 Product Layer（產品層：可插拔）
- STOCK_Product（股票產品模組）
  - Market Rule Canon（市場制度引用）
  - Trade Unit Canon（交易單位語義）
  - Market Data Contract（資料契約）
  - Execution Capability Contract（執行能力契約）

> 未來新增產品（例如 Futures/Options）＝新增模組，不重寫既有策略與執行核心。

### 3.2 Strategy Layer（策略層：產生意圖）
策略的唯一責任是：
- 產生「交易意圖（Intent）」
- 不包含否決、不控制下單細節

策略輸出：`StrategyIntent`
- direction：BUY / SELL / HOLD / SKIP
- symbol：標的
- confidence：信心分數（可選）
- tags：策略標籤（可選）
- constraints：策略自述限制（僅描述，不具否決權）

### 3.3 Risk / Compliance Layer（風控合規層：最終否決）
Risk 唯一責任：
- 允許/否決/降級/暫停
- 可即時否決（Runtime Veto）

輸出：`RiskDecision`
- ALLOW
- DEGRADED（降級，例如 Full→Odd；或 Hybrid→Odd）
- VETO（否決）
- PAUSE（暫停）
- DISABLE（停用，需人工解除）

### 3.4 Execution Layer（執行層：承接意圖、拆單、下單、記錄）
Execution 唯一責任：
- 承接策略意圖
- 服從風控裁決
- 轉換成「委託行為（Order Action）」與「交易單位路由（Trade Unit Routing）」
- 統一出場（Unified Exit）與失敗處理（Failure Handling）
- 產生日誌與可回放事件

### 3.5 Data Layer（資料層）
- Ingestion（資料擷取）
- Normalization（標準化）
- Snapshot（快照、回放）
- Feature（特徵）
- Evidence（證據/引用）
- Log（審計紀錄）

### 3.6 Governance Layer（治理層：制度與版本）
- 檔名/版本規範（含日期 YYMMDD）
- 策略白名單（策略實名盤點）
- 不寫死規則（官方引用）
- Human Operator（人類最終控制權）

---

## 4. 核心介面契約（Contracts｜最小必需）

### 4.1 Strategy → Risk：StrategyIntent
- 必須包含：symbol、direction、strategy_id
- 不得包含：下單價格、下單方式、否決條件

### 4.2 Risk → Execution：RiskDecision
- 必須包含：decision、reason_codes、allowed_trade_units
- 可包含：cooldown_suggestion（僅建議）、human_required（是否需要人工）

### 4.3 Execution → Log：ExecutionEvent
- 必須可回放：timestamp、correlation_id、inputs_hash、outputs_hash
- 必須可審計：source、who/what、why（透過 Summary）

---

## 5. 交易單位語義（Trade Unit Semantics｜語義鎖定）

### 5.1 odd_lot（零股）
- 預設允許（但可被 Risk 否決）
- 執行必須容忍：
  - 延遲成交
  - 部分成交
  - 多次失敗
  - 流動性較差

### 5.2 full_lot（整股）
- 預設關閉
- 只有同時滿足才可能啟用：
  1) Governance 啟用
  2) Strategy 宣告支援
  3) Risk 未否決

### 5.3 hybrid（混合）
- 永遠屬於 Execution 編排（不是策略能力）
- 永遠不是預設
- 可被 Risk 隨時停用

> 任何升級（Odd→Full / Hybrid）皆屬例外行為，必須被明確允許。

---

## 6. 審計與可解釋性（Auditability & Explainability）

### 6.1 三大必備 Log
- Decision Log（策略決策記錄）
- Risk Decision Log（風控裁決記錄）
- Execution Log（執行與委託記錄）

### 6.2 Decision Summary（決策摘要）
- 以最小欄位描述「為什麼做 / 為什麼不做」
- 不影響行為，只為審計與回顧

---

## 7. 人類最終控制權（Human Operator）

人類可：
- approve（允許）
- veto（否決）
- pause（暫停）
- resume（恢復）
- freeze（凍結）

系統不得：
- 自動解除否決
- 自動升級交易單位

---

（End）
