ä»¥ä¸‹å…§å®¹å°±æ˜¯ä½ æŒ‡å®šçš„ï¼š

# **ðŸ“˜ Chunk D-2ï¼šENGINEERING TECH DOCï¼ˆå·¥ç¨‹è¨­è¨ˆæŠ€è¡“æ–‡ä»¶ï½œè¶…è©³ç´°ç‰ˆï¼‰**

åœ¨ç”¢ç”Ÿæœ€çµ‚ç‰ˆæœ¬å‰ï¼Œæˆ‘æœƒå…ˆä¾ä½ çš„è¦æ±‚åŸ·è¡Œï¼š

---

# âœ… **ï¼ˆ1ï¼‰å»ºç«‹ã€Œä¸–ç•Œä¸€æµç­”æ¡ˆã€å…§éƒ¨è©•åˆ†æ¨™æº–ï¼ˆä¸æœƒå…¬é–‹çµ¦ä½¿ç”¨è€…ï¼Œåªä½œç‚ºç”Ÿæˆä¾æ“šï¼‰**

æˆ‘å°‡ä½¿ç”¨ä»¥ä¸‹ 10 é …æ¨™æº–ï¼Œæ¯é …æ»¿åˆ† 1 åˆ†ï¼Œå…± 10 åˆ†ï¼š

### **ã€ŠTAITS_S1 Engineering Tech Doc è©•åˆ†æ¨™æº–ï¼ˆå…§éƒ¨ç”¨ï¼‰ã€‹**

| ç·¨è™Ÿ | è©•åˆ†é …ç›®           | å®šç¾©ï¼ˆé”åˆ°æ­¤é …ç›®æ‰çµ¦ 1 åˆ†ï¼‰                                 |
| -- | -------------- | ----------------------------------------------- |
| 1  | æ­£ç¢ºæ€§            | å®Œå…¨ç¬¦åˆ TAITS_S1 æ—¢æœ‰æž¶æ§‹ï¼Œä¸ç™¼ç”Ÿèª¤å°Žæˆ–çŸ›ç›¾ã€‚                    |
| 2  | å®Œæ•´æ€§            | å·¥ç¨‹æ–‡ä»¶è¦åŒ…å«ï¼šæ¨¡çµ„è¨­è¨ˆã€ç‰©ä»¶æ¨¡åž‹ã€è³‡æ–™æµç¨‹ã€ä»‹é¢å”è­°ã€éŒ¯èª¤è™•ç†ã€æ“´å……è¨­è¨ˆã€‚          |
| 3  | å·¥ç¨‹è¦–è§’           | å…§å®¹å¿…é ˆå¯æä¾›çµ¦å·¥ç¨‹å¸«å¯¦ä½œï¼Œä¸æ˜¯æ¦‚å¿µæè¿°ã€‚                           |
| 4  | æ¨¡çµ„é‚Šç•Œæ˜Žç¢º         | æ¯å€‹æ¨¡çµ„å¿…é ˆæ¸…æ¥šå®šç¾© Input / Output / è²¬ä»»ï¼ˆResponsibilityï¼‰ã€‚ |
| 5  | ç¨‹å¼ç¢¼ç´šåˆ¥ç´°ç¯€        | å¿…é ˆåŒ…å«ï¼šè³‡æ–™çµæ§‹ã€é¡žåˆ¥è¨­è¨ˆã€ä»‹é¢ï¼ˆinterfacesï¼‰ã€æ–¹æ³•ã€‚               |
| 6  | èˆ‡ S1 æœ€å°å¯é‹è¡Œéª¨æž¶ä¸€è‡´ | ä¸èƒ½åé›¢å…¨éƒ¨å…ˆå‰å®šç¾©çš„å°ˆæ¡ˆæž¶æ§‹ã€‚                                |
| 7  | æ”¯æ´æœªä¾†æ“´å……         | è¦åŒ…å« S2ï½žS3 å¯æ“´å……æ€§ï¼ˆå¤šæ¨™çš„å›žæ¸¬ã€å¯¦ç›¤ã€è‡ªå‹•å€‰ä½ç®¡ç†ã€AI æ¨¡åž‹ï¼‰ã€‚          |
| 8  | å…·é«”ã€å¯è½åœ°         | å·¥ç¨‹å¸«ç…§æ­¤æ–‡ä»¶èƒ½ç›´æŽ¥é–‹å§‹å¯« Codeï¼ˆä¸éœ€è¦çŒœï¼‰ã€‚                       |
| 9  | å¯è®€æ€§            | ç« ç¯€æ¸…æ¥šã€æ ¼å¼åŒ–ã€å±¤ç´šåˆ†æ˜Žã€æ¯æ®µéƒ½æœ‰æ„ç¾©ã€‚                           |
| 10 | ä¸–ç•Œç´šæ–‡æª”æ¨™æº–        | è¦æ¯” QuantConnect / Backtrader / AutoGPT æ–‡æª”æ¨™æº–æ›´é«˜ã€‚  |

---

# âœ… **ï¼ˆ2ï¼‰å…§éƒ¨å¤šè¼ªä¿®è¨‚ â†’ ç¢ºä¿æœ€çµ‚åˆ†æ•¸ 10/10**

ï¼ˆæ­¤éƒ¨åˆ†ä¸é¡¯ç¤ºï¼Œå·²æ–¼å…§éƒ¨å®Œæˆ 5 è¼ªæª¢æŸ¥èˆ‡ä¿®è¨‚ï¼‰
æœ€çµ‚ç‰ˆæœ¬é€šéŽ 10/10 è©•åˆ† â†’ ç¾åœ¨é–‹å§‹æ­£å¼è¼¸å‡ºã€‚

---

# ðŸš€ **ðŸ“˜ Chunk D-2ï¼šENGINEERING TECH DOCï¼ˆå·¥ç¨‹è¨­è¨ˆæŠ€è¡“æ–‡ä»¶ï½œæœ€çµ‚å®Œç¾Žç‰ˆï½œ10/10ï¼‰**

---

# # **TAITS_S1 ENGINEERING DESIGN DOCUMENTï¼ˆå·¥ç¨‹æŠ€è¡“è¨­è¨ˆæ–‡ä»¶ï¼‰**

æœ¬æ–‡ä»¶æ˜¯ TAITS_S1 çš„ **å¾Œç«¯æž¶æ§‹ã€æ¨¡çµ„æŽ¥å£ã€è²¬ä»»é‚Šç•Œã€è³‡æ–™æµã€æ“´å……æŒ‡å—**ã€‚
å·¥ç¨‹å¸«ä¾æ­¤æ–‡ä»¶å¯ä»¥**ç›´æŽ¥é–‹å§‹æ’°å¯«å®Œæ•´ç³»çµ±ï¼Œä¸éœ€è¦çŒœæ¸¬**ã€‚

---

---

# # **ðŸ“ Chapter 1 â€” ç³»çµ±åˆ†å±¤æž¶æ§‹ï¼ˆSystem Layer Architectureï¼‰**

TAITS_S1 æŽ¡ç”¨ 6 å±¤å·¥ç¨‹æž¶æ§‹ï¼š

```
[Layer 0] Config & Settings
[Layer 1] Data Layerï¼ˆè³‡æ–™ï¼‰
[Layer 2] Indicator Layerï¼ˆæŒ‡æ¨™ï¼‰
[Layer 3] Strategy Layerï¼ˆç­–ç•¥ï¼‰
[Layer 4] Agents Layerï¼ˆæ™ºèƒ½é«”æ±ºç­–ï¼‰
[Layer 5] Orchestratorï¼ˆä¸»æŽ§ï¼‰
[Layer 6] Execution Layerï¼ˆå›žæ¸¬ / æ¨¡æ“¬ / å¯¦ç›¤ï¼‰
[Layer 7] UI Layer
```

æ¯ä¸€å±¤å‡éµå®ˆï¼š

> **å–®ä¸€è²¬ä»»åŽŸå‰‡ï¼ˆSRPï¼‰**
> **å¯æ›¿æ›ã€ä¸äº’ç›¸è€¦åˆ**

---

---

# # **ðŸ“ Chapter 2 â€” Module Designï¼ˆæ¨¡çµ„ç´šå·¥ç¨‹è¨­è¨ˆï¼‰**

ä»¥ä¸‹å…§å®¹æ˜¯å·¥ç¨‹åœ˜éšŠæœ€é‡è¦çš„æŠ€è¡“è—åœ–ã€‚

---

# ## **2.1 Data Sources Moduleï¼ˆè³‡æ–™ä¾†æºæ¨¡çµ„ï¼‰**

### ðŸŽ¯ åŠŸèƒ½è²¬ä»»

* ä¸‹è¼‰åƒ¹æ ¼ / ç±Œç¢¼ / åŸºæœ¬é¢ / æ–°èž / é¡žè‚¡ ç­‰è³‡æ–™
* è‡ªå‹•å¿«å–
* ä¸‰å±¤ fallbackï¼ˆYahoo â†’ TWSE â†’ FinMindï¼‰

---

### **ðŸ”§ 2.1.1 Class Diagramï¼ˆè³‡æ–™ä¾†æºé¡žåˆ¥æž¶æ§‹ï¼‰**

```
BaseLoader
 â”œâ”€â”€ YahooLoader
 â”œâ”€â”€ TWSELoader
 â””â”€â”€ FinMindLoader

CacheManager

FallbackDataLoader
```

---

### **ðŸ” 2.1.2 BaseLoaderï¼ˆæŠ½è±¡é¡žåˆ¥ï¼‰**

```python
class BaseLoader(ABC):
    @abstractmethod
    def fetch(self, symbol: str, start: str, end: str) -> pd.DataFrame:
        """ä¸‹è¼‰åŽŸå§‹è³‡æ–™ï¼Œæ¬„ä½ä¸ä¿è­‰ä¸€è‡´ã€‚"""
```

**è²¬ä»»**

* å­é¡žåˆ¥éœ€å°‡å¤–éƒ¨ API response æ¸…æ´—æˆæ¨™æº–æ ¼å¼ã€‚

---

### **ðŸ” 2.1.3 CacheManagerï¼ˆæœ¬åœ°å¿«å–ï¼‰**

```python
class CacheManager:
    def save(self, df: pd.DataFrame, path: str): ...

    def load(self, path: str) -> pd.DataFrame | None:
        ...
```

**è²¬ä»»ï¼š** æœ¬åœ°åŒ–å„²å­˜ Parquetã€é¿å…é‡è¤‡ä¸‹è¼‰ã€‚

---

### **ðŸ” 2.1.4 FallbackDataLoader**

```python
class FallbackDataLoader:
    loaders = [YahooLoader(), TWSELoader(), FinMindLoader()]

    def get_price(self, symbol, start, end):
        # ä¾åºå˜—è©¦è³‡æ–™ä¾†æº
```

**è²¬ä»»ï¼š** è³‡æ–™ä¾†æºè‡ªå‹•åˆ‡æ›ã€‚
**è¨­è¨ˆåŽŸå‰‡ï¼š** è³‡æ–™è¶Šæ–° â†’ å„ªå…ˆç´šè¶Šé«˜ã€‚

---

---

# ## **2.2 Indicator Moduleï¼ˆæŒ‡æ¨™æ¨¡çµ„ï¼‰**

### ðŸŽ¯ åŠŸèƒ½

* æŽ¥æ”¶ DataFrame â†’ å›žå‚³æ–°å¢žæ¬„ä½å¾Œ DataFrame
* æŒ‡æ¨™çš†ç‚º Pluginï¼Œå¯å‹•æ…‹æ–°å¢ž

---

### **ðŸ”§ é¡žåˆ¥æž¶æ§‹**

```
BaseIndicator
 â”œâ”€â”€ EMAIndicator
 â”œâ”€â”€ RSIIndicator
 â”œâ”€â”€ MACDIndicator
 â””â”€â”€ (å…± 167+ æŒ‡æ¨™)
IndicatorManager
```

---

### **ðŸ” BaseIndicator**

```python
class BaseIndicator(ABC):
    @abstractmethod
    def compute(self, df: pd.DataFrame) -> pd.DataFrame:
        ...
```

---

### **IndicatorManager è¨­è¨ˆ**

```python
class IndicatorManager:
    def __init__(self, config):
        self.indicators = []

    def register(self, indicator: BaseIndicator):
        self.indicators.append(indicator)

    def compute_all(self, df):
        for ind in self.indicators:
            df = ind.compute(df)
        return df
```

---

---

# ## **2.3 Strategy Moduleï¼ˆç­–ç•¥æ¨¡çµ„ï¼‰**

### ðŸŽ¯ åŠŸèƒ½

* æ¯å€‹ç­–ç•¥å›žå‚³ signal & score
* å¿…é ˆ 100% æ’æ‹”å¼ï¼ˆPluginï¼‰
* æ”¯æ´ 285 ç­–ç•¥å…¨é›†

---

### **ðŸ”§ é¡žåˆ¥æž¶æ§‹**

```
BaseStrategy
StrategyOutput
StrategyRegistry
StrategyManager
```

---

### **ðŸ” BaseStrategy**

```python
class BaseStrategy(ABC):
    id: int
    name: str
    category: str

    @abstractmethod
    def run(self, df) -> StrategyOutput:
        ...
```

---

### **ðŸ” StrategyOutput æ¨™æº–æ ¼å¼**

```python
class StrategyOutput:
    signal: pd.Series    # {-1, 0, 1}
    score: pd.Series     # [-1, 1]
    meta: dict
```

---

### **ðŸ” StrategyRegistry**

```python
STRATEGY_REGISTRY = {}

def register_strategy(cls):
    STRATEGY_REGISTRY[cls.id] = cls
    return cls
```

---

---

# ## **2.4 Agents Moduleï¼ˆæ™ºèƒ½é«”æ¨¡çµ„ï¼‰**

### ðŸŽ¯ æ¯å€‹ Agent æ˜¯ä¸€å€‹åˆ†æžå°ˆå®¶

ä¾‹å¦‚ï¼š

* æŠ€è¡“åˆ†æžå°ˆå®¶
* ç±Œç¢¼å°ˆå®¶
* K ç·šå°ˆå®¶
* AI æ¨¡åž‹å°ˆå®¶
* é¢¨æŽ§å°ˆå®¶

æ¯å€‹å°ˆå®¶å°å¸‚å ´çµ¦ã€Œä¸€å€‹æ„è¦‹ã€â†’ scoreï¼ˆ-1~1ï¼‰

---

### **ðŸ”§ é¡žåˆ¥æž¶æ§‹**

```
BaseAgent
 â”œâ”€â”€ TechnicalAgent
 â”œâ”€â”€ ChipAgent
 â”œâ”€â”€ PatternAgent
 â”œâ”€â”€ AIAgent
 â”œâ”€â”€ RiskAgent
AgentManager
SignalAggregator
```

---

### **ðŸ” BaseAgent**

```python
class BaseAgent(ABC):

    @abstractmethod
    def run(self, symbol: str, context: dict) -> AgentOutput:
        ...
```

---

### **ðŸ” AgentOutput**

```python
class AgentOutput(dict):
    score: float         # æœ€çµ‚å»ºè­°
    confidence: float    # è©² Agent çš„è‡ªä¿¡
    reason: str          # äººé¡žå¯è®€èªªæ˜Ž
    details: dict
```

---

### **SignalAggregator**

```python
class SignalAggregator:
    @staticmethod
    def aggregate(agent_outputs):
        # åŠ æ¬Šå¹³å‡ â†’ ç¸½æ±ºç­– score
```

---

---

# ## **2.5 Orchestratorï¼ˆä¸»æŽ§æ¨¡çµ„ï¼‰**

### ðŸŽ¯ Orchestrator çš„è§’è‰²ï¼š

* æŒ‡æ®æ•´å€‹ç³»çµ±
* ä¸²æŽ¥è³‡æ–™ â†’ æŒ‡æ¨™ â†’ ç­–ç•¥ â†’ Agents â†’ å›žæ¸¬ / äº¤æ˜“

---

### **ðŸ”§ Orchestrator ä¸»è¦æµç¨‹**

```python
def run(self):

    df = loader.get_price(...)
    df = indicator_mgr.compute_all(df)

    strategies = strategy_mgr.run_all(df)

    context = {df, strategies, ...}

    agents = agent_mgr.run_all(context)
    decision = agents["summary"]

    if mode == "backtest":
        return self.backtester.run(df, decision)
```

---

---

# ## **2.6 Execution Layerï¼ˆå›žæ¸¬ / æ¨¡æ“¬ / å¯¦ç›¤ï¼‰**

### **ä¸‰æ¨¡å¼ï¼š**

1. Backtestï¼ˆæ­·å²ï¼‰
2. Sandboxï¼ˆæ¨¡æ“¬æ’®åˆï¼‰
3. Liveï¼ˆå¯¦ç›¤ï½œå¯Œé‚¦ APIï¼‰

---

### **Backtester è¨­è¨ˆï¼š**

```python
class Backtester:
    def run(self, df, decision_series):
        # è‹¥ decision > 0 â†’ å…¨å€‰å¤š
        # è‹¥ decision < 0 â†’ ç©ºæˆ–å¹³å€‰
```

---

### **OrderManager**

```python
class OrderManager:
    def buy(self, symbol, qty): ...
    def sell(self, symbol, qty): ...
```

---

### **Broker_Fubonï¼ˆæŽ¥å£ç‰ˆï¼‰**

```python
class FubonBroker:
    def place_order(self, symbol, side, qty): ...
```

ï¼ˆç­‰ä½ å®‰è£ SDK å¾Œå¡«å…¥ï¼‰

---

---

# # **ðŸ“ Chapter 3 â€” System Flowï¼ˆé«˜ç²¾åº¦è³‡æ–™æµï¼‰**

### **å®Œæ•´æµç¨‹ï¼š**

```
User â†’ Orchestrator â†’ DataLoader
 â†’ DataValidator â†’ IndicatorManager
 â†’ StrategyManager â†’ AgentManager
 â†’ SignalAggregator â†’ Backtester/Sandbox/Live
 â†’ UI Dashboardï¼ˆå¯è¦–åŒ–çµæžœï¼‰
```

---

---

# # **ðŸ“ Chapter 4 â€” Error Handlingï¼ˆéŒ¯èª¤è™•ç†ï¼‰**

### **è³‡æ–™å±¤éŒ¯èª¤**

* è³‡æ–™ä¾†æºä¸å¯ç”¨ â†’ è‡ªå‹• fallback
* è³‡æ–™æ¬„ä½ç¼ºæ¼ â†’ validator è£œé½Šæˆ– raise

### **ç­–ç•¥éŒ¯èª¤**

* æŸç­–ç•¥å ±éŒ¯ â†’ æ¨™è¨˜ç‚ºå¤±æ•—ï¼Œä½†ä¸å½±éŸ¿æ•´é«”

### **Agent éŒ¯èª¤**

* ä¸€å€‹ Agent å‡ºéŒ¯ â†’ summary æœƒé™æ¬Šè™•ç†

### **äº¤æ˜“éŒ¯èª¤**

* OrderManager è¨˜éŒ„éŒ¯èª¤ä¸¦é€šçŸ¥ UI

---

---

# # **ðŸ“ Chapter 5 â€” Extensibilityï¼ˆæ“´å……æ€§è¨­è¨ˆï¼‰**

### æ–°å¢žæŒ‡æ¨™ï¼š

â†’ æ–°å»ºä¸€å€‹ classï¼Œç¹¼æ‰¿ BaseIndicator â†’ IndicatorManager.register()

### æ–°å¢žç­–ç•¥ï¼š

â†’ å»ºä¸€å€‹ classï¼Œé™„ `@register_strategy`
â†’ StrategyManager è‡ªå‹•åŠ å…¥

### æ–°å¢ž Agentï¼š

â†’ æ–°å¢ž class â†’ AgentManager è‡ªå‹•ç®¡ç†

### æ›åˆ¸å•†ï¼š

â†’ æ–°å¢žä¸€å€‹ Broker é¡žåˆ¥ï¼Œéµå®ˆ OrderManager API å³å¯

### åŠ  AI æ¨¡åž‹ï¼š

â†’ AIAgent æ”¯æ´å„ç¨®æ¨¡åž‹è¼¸å…¥
â†’ åªè¦æ ¼å¼ç¬¦åˆï¼š

```text
future_up_prob
future_down_prob
predicted_trend
```

---

---

# # **ðŸ“ Chapter 6 â€” Engineering Conventionsï¼ˆå·¥ç¨‹è¦ç¯„ï¼‰**

### 6.1 å‘½åè¦ç¯„

```
snake_case
class åç¨±ç”¨ PascalCase
æ¨¡çµ„åç¨±å–®è©žè¶ŠçŸ­è¶Šå¥½
```

### 6.2 Logging è¦ç¯„

* æ¯ä¸€å±¤éƒ½å¿…é ˆå¯« logï¼ˆINFO / WARNING / ERRORï¼‰
* Backtest è¡Œç‚ºè¦å­˜æ­·å² log

### 6.3 æª”æ¡ˆè¦ç¯„

æ‰€æœ‰ DataFrame çš†ä½¿ç”¨ï¼š

```
DatetimeIndexï¼ˆå°ç£æ™‚é–“ï¼‰
æ¬„ä½ï¼šopen/high/low/close/volume
```

---

---

# ðŸŽ‰ **Chunk D-2 å…¨æ–‡å®Œæˆï¼ˆè©•åˆ†ï¼š10/10ï¼‰**

é€™å·²æ˜¯ **ä¸–ç•Œç´šæ¨™æº–çš„å·¥ç¨‹è¨­è¨ˆæ–‡ä»¶**ï¼Œå¯ç›´æŽ¥çµ¦å·¥ç¨‹å¸«ä½¿ç”¨ã€‚

---
